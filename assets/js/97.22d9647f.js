(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{361:function(s,a,t){"use strict";t.r(a);var e=t(13),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"架构分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构分析"}},[s._v("#")]),s._v(" 架构分析")]),s._v(" "),a("h3",{attrs:{id:"一-一条查询sql语句是如何执行的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-一条查询sql语句是如何执行的"}},[s._v("#")]),s._v(" 一：一条查询SQL语句是如何执行的？")]),s._v(" "),a("p",[s._v("客户端   --连接--》查询缓存 ---》解析器  ---》 预处理器  ---》 查询优化器 ---》 执行计划 ---》 执行引擎  --1-》  存储引擎  --2-》  客户端")]),s._v(" "),a("h4",{attrs:{id:"第一步、连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一步、连接"}},[s._v("#")]),s._v(" "),a("strong",[s._v("第一步、连接")])]),s._v(" "),a("p",[s._v("MySQL服务监听的端口默认是3306。"),a("br"),s._v("\n客户端连接服务端的方式有很多：")]),s._v(" "),a("ul",[a("li",[s._v("同步、异步")]),s._v(" "),a("li",[s._v("TCP、Unix Socket")])]),s._v(" "),a("p",[s._v("MySQL有专门处理连接的模块，连接的时候需要验证权限")]),s._v(" "),a("p",[a("strong",[s._v("如何查看MySQL当前有多少个连接？")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Thread%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Threads_cached      缓存中的线程连接数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Threads_connected   当前打开的连接数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Threads_created     为处理连接创建的线程数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Threads_running     非睡眠状态的连接数，通常指并发连接数")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("为什么连接数是查看线程？客户端的连接和服务端的线程有什么关系？")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("MySQL是一个单进程多线程。客户端每产生一个连接或者一个会话，在服务端就会创建一个线程来处理。如果要杀死会话，就会kill线程   \n\nMySQL会把那些长时间不活动的（SLEEP）连接自动断开\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 非交互式超时时间 eg:jdbc程序")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wait_timeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  交互式超时时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'interactive_timeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接数（并发数）  服务端默认的最大连接数：5.7版本max=151")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'max_connections'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL参数文档"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[s._v("关于参数"),a("code",[s._v("scope")]),s._v("，有两个值："),a("code",[s._v("Global,Session")]),s._v("级别\n"),a("ul",[a("li",[s._v("Global：全局生效")]),s._v(" "),a("li",[s._v("Session：会话生效")]),s._v(" "),a("li",[s._v("不是所有的参数都有这两个级别，如max_connections就只有Global级别")]),s._v(" "),a("li",[s._v("如果没有带参数的时候，默认是session级别，包括查询和修改")])])])]),s._v(" "),a("h4",{attrs:{id:"第二步、查询缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二步、查询缓存"}},[s._v("#")]),s._v(" "),a("strong",[s._v("第二步、查询缓存")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("MySQL内部自带一个缓存模块，默认是关闭的（因为不推荐使用）  \n\n为什么不推荐使用：           \n- 要求SQL语句必须一模一样，多个空格，大小写不一致都视为不同的SQL\n- 表里任何一条数据发生变化的时候，这张表的缓存也会失效\n\n所以一般缓存这块就交给ORM框架（如MyBatis默认开启了一级缓存，或者使用Redis） \n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看缓存")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'query_cache%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("注意：在MySQL8.0中，查询缓存已经被移除了")]),s._v(" "),a("h4",{attrs:{id:"第三步、解析器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三步、解析器"}},[s._v("#")]),s._v(" 第三步、解析器")]),s._v(" "),a("p",[s._v("主要是对语句基于SQL语法进行词法和语法分析和语义的解析。通过MySQL的"),a("code",[s._v("Parser")]),s._v("解析器和"),a("code",[s._v("Preprocessor")]),s._v("预处理模块，来判断我输入的sql是否错误")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("1、词法解析")]),s._v(" "),a("ul",[a("li",[s._v("将一个完整的SQL语句打碎成一个个的单词")]),s._v(" "),a("li",[s._v("如： "),a("code",[s._v("SELECT name FROM user WHERE id = 1;")]),s._v(" 会打碎成8个符号")])])]),s._v(" "),a("li",[a("p",[s._v("2、语法解析")]),s._v(" "),a("ul",[a("li",[s._v("对SQL进行语法检查，如单引号有无闭合，根据MySQL定义的语法规则，根据SQL语句生成一个数据结构。我们称为"),a("strong",[s._v("解析树（select_lex）")]),a("br"),s._v(" "),a("img",{attrs:{src:"https://gitee.com/giveSomethingAGo/blog/blob/master/vpressV1/images/mysql/selectLex.png"}})])])]),s._v(" "),a("li",[a("p",[s._v("3、预处理器")]),s._v(" "),a("ul",[a("li",[s._v("它会检查生成的解析树，解决解析器无法解析的语义。比如，会检查表和列名是否存在，检查名字和别名，保证没有歧义。预处理后得到一个新的解析树。")]),s._v(" "),a("li")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);